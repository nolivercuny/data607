---
title: "Final Project Analysis"
author: "Nick Oliver"
output:
  prettydoc::html_pretty:
    theme: hpstr
    highlight: github
editor_options: 
  chunk_output_type: console
---

# Exploratory Analysis

```{r}
library(DBI)
library(tidyverse)
library(tidytext)
library(cowplot)
```

```{r}
con <- dbConnect(RSQLite::SQLite(), dbname = "final_project.db")
wiredArticlesRawDf <- dbGetQuery(con, "SELECT * FROM Articles;")
glimpse(wiredArticlesRawDf)
dbDisconnect(con)
```


- cleanup data

```{r}
wiredArticlesDf <- wiredArticlesRawDf %>% 
  filter(!is.na(body)) %>%
  mutate(publishDate=as.Date(publishDate, format = "%m.%d.%Y")) %>%
  mutate(publishYear=as.numeric(format(publishDate, "%Y")))
```

Due to the random sampling of articles I scraped, I may have a varying amounts of articles for each year. To account for that I will sample a number of articles from each year where the sample size is the number of articles in the year with the least amount of articles
```{r}
minSampleSize <- wiredArticlesDf %>% 
  group_by(publishYear) %>%
  count() %>%
  min()
articlesGrouped <- wiredArticlesDf %>% 
  group_by(publishYear) %>% 
  filter(n() > 20) %>%
  slice_sample(n = 20) #temp

articlesGrouped %>% count()
```

Number of unique words in the entire year

```{r}
totalWords <- articlesGrouped %>% 
  unnest_tokens(word,body,token="words", strip_punct=TRUE) %>%
  count(publishYear) %>%
  rename(totalWords = n)

totalPlot <- totalWords %>%
  ggplot(aes(x=publishYear, y=totalWords)) +
  geom_line()
```


number of unique words in the entire year
```{r}
totalDistinctWords <- articlesGrouped %>% 
    unnest_tokens(word,body,token="words", strip_punct=TRUE) %>%
    group_by(publishYear) %>%
    mutate(uniqueWordsCount = n_distinct(word)) %>%
    select(publishYear, uniqueWordsCount) %>%
    distinct()

distinctPlot <- totalDistinctWords %>%
  ggplot(aes(x=publishYear, y=uniqueWordsCount)) +
  geom_line()

```

```{r}
meanCountByArticleByYear <- wiredArticlesDf %>% 
  group_by(publishYear, id) %>% 
  unnest_tokens(word,body,token="words", strip_punct=TRUE) %>%
  count() %>%
  ungroup() %>%
  group_by(publishYear) %>%
  summarise(avg = mean(n))
meanCountPlot <- meanCountByArticleByYear %>%
  ggplot(aes(x=publishYear, y=avg)) +
  geom_line()
```

Here we can see that there is a distinct rise in article length on average, in total word count and distinct word count after the year 2004. 
```{r}
plot_grid(totalPlot, distinctPlot,meanCountPlot, labels = "AUTO")
```


