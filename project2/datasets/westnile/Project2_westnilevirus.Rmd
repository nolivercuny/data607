---
title: "Project 2 West Nile Virus"
author: "Nick Oliver"
output:
  prettydoc::html_pretty:
    theme: hpstr
    highlight: github
editor_options: 
  chunk_output_type: console
---

# Project 2 - West Nile Virus

https://bbhosted.cuny.edu/webapps/discussionboard/do/message?action=list_messages&course_id=_2010109_1&nav=discussion_board_entry&conf_id=_2342994_1&forum_id=_2992508_1&message_id=_54088437_1

https://www.cdc.gov/westnile/statsmaps/cumMapsData.html

There are two tables here with the cases each year in a separate column:

West Nile virus disease cases reported to CDC by state of residence, 1999-2019

West Nile virus neuroinvasive disease cases reported to CDC by state of residence, 1999-2019

The totals per state & per year are already calculated, but the means are yet to be calculated.

The year columns could be pivoted longer and the 2 tables could be combined. Percent of positive cases that developed into neuroinvasive disease could be calculated (per year / per state).

## Setup

### Load Libraries
```{r}
library(RCurl)
library(stringr)
library(dplyr)
library(tidyr)
library(kableExtra)
library(readr)
library(fuzzyjoin)
```

### Load Data

```{r}
westNileCasesUrl <- 'https://raw.githubusercontent.com/nolivercuny/data607/master/project2/datasets/westnile/West-Nile-virus-disease-cases-by-state_1999-2019-P.csv'
westNileCasesRaw <- read.csv(westNileCasesUrl, sep = " ", skip = 1)
#westNileCasesRaw <- getURL(westNileCasesUrl)
westNileNeuroUrl <- 'https://raw.githubusercontent.com/nolivercuny/data607/master/project2/datasets/westnile/West-Nile-virus-neuroinvasive-disease-cases-by-state_1999-2019-P.csv'
westNileNeuroRaw <- read.csv(westNileNeuroUrl, sep = " ", skip = 1)
#westNileNeuroRaw <- getURL(westNileNeuroUrl)
```

## Tidy

```{r}
westNileCasesDf <- westNileCasesRaw %>% 
  as.data.frame()

```

Fix DC because it's the only one that has three spaces in the name
```{r}
# District of Columbia 9,78
dc <- westNileCasesDf[9,] %>% unite(State,1:3, sep = " ")
westNileCasesDf[9,]$State <- dc[1]
westNileCasesDf[78,]$State <- dc[1]

westNileCasesDf[9,2:3] <- westNileCasesDf[10,1:2]
westNileCasesDf[78,2:3] <- westNileCasesDf[79,1:2]
```

```{r}
#there is probably a clever way to find these
statesWithSpaces <- c(31,33,35,37,39,41,47,49,51,53,61,100,102,104,106,108,110,116,118,120,122,130)
for (index in statesWithSpaces) {
  dc <- westNileCasesDf[index,] %>% unite(State,1:2, sep = " ")
  westNileCasesDf[index,]$State <- dc[1]
  westNileCasesDf[index,2] <- westNileCasesDf[index+1,1]
}
```

Filter all the columns with bad/meaningless data. Had to do `gsub` because there were some rows where the number had a comma, which meant it was parsed as `NA` and didn't get filtered
```{r}
westNileCasesDf <- westNileCasesDf %>% filter(is.na(as.numeric(gsub(",", "",State))))
```

Now we have two data sets combined into one. I will need to split the dataframe and recombined it by state.

```{r}
df_one <- westNileCasesDf[1:52,]
df_two <- westNileCasesDf[57:109,]
# this doesn't work right because the state, 2010, and 2011 have whitespace in them
names(df_two) <- df_two[1,]
```

